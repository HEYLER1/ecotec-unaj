<div class="form-container">
  <ng-container *ngIf="sedeActual">

    <div class="form-header">
      <h2>Formulario Sede {{ sedeActual.name | uppercase }}</h2>
      <p>Ingrese los datos correctamente</p>
    </div>

    <form [formGroup]="wasteForm" (ngSubmit)="onSubmit()" class="waste-actual-form">

      <!-- ============================================= -->
      <!-- ==      FORMULARIO PARA EL ESTUDIANTE      == -->
      <!-- ============================================= -->
      <ng-container *ngIf="currentUserRole === 'ESTUDIANTE'">
        
        <mat-form-field appearance="fill" class="custom-form-field">
          <mat-label>Edificios</mat-label>
          <mat-select formControlName="edificioId" disableRipple>
            <mat-option *ngFor="let edificio of edificiosDeLaSede" [value]="edificio.id">
              {{ edificio.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill" class="custom-form-field">
          <mat-label>Pilas</mat-label>
          <input matInput formControlName="pilasCodigo" placeholder="Escriba el código...">
        </mat-form-field>
        
        <div class="segregation-header">
          <h3>¿Se segregó correctamente?</h3>
          <div class="si-no-legend">
            <span>SI</span>
            <span>NO</span>
          </div>
        </div>

        <div class="residue-list">
          <!-- (Contenido del formulario de estudiante sin cambios) -->
          <div class="residue-item" style="background-color: #3498db;"><span>Plásticos</span><div class="checkbox-group"><div class="custom-checkbox" [class.selected]="wasteForm.get('plasticos')?.value === 'si'" (click)="wasteForm.get('plasticos')?.setValue('si')"></div><div class="custom-checkbox" [class.selected]="wasteForm.get('plasticos')?.value === 'no'" (click)="wasteForm.get('plasticos')?.setValue('no')"></div></div></div>
          <div class="residue-item" style="background-color: #a37c58;"><span>Orgánicos</span><div class="checkbox-group"><div class="custom-checkbox" [class.selected]="wasteForm.get('organicos')?.value === 'si'" (click)="wasteForm.get('organicos')?.setValue('si')"></div><div class="custom-checkbox" [class.selected]="wasteForm.get('organicos')?.value === 'no'" (click)="wasteForm.get('organicos')?.setValue('no')"></div></div></div>
          <div class="residue-item" style="background-color: #2ecc71;"><span>Vidrio</span><div class="checkbox-group"><div class="custom-checkbox" [class.selected]="wasteForm.get('vidrio')?.value === 'si'" (click)="wasteForm.get('vidrio')?.setValue('si')"></div><div class="custom-checkbox" [class.selected]="wasteForm.get('vidrio')?.value === 'no'" (click)="wasteForm.get('vidrio')?.setValue('no')"></div></div></div>
          <div class="residue-item" style="background-color: #f1c40f;"><span>Metales</span><div class="checkbox-group"><div class="custom-checkbox" [class.selected]="wasteForm.get('metales')?.value === 'si'" (click)="wasteForm.get('metales')?.setValue('si')"></div><div class="custom-checkbox" [class.selected]="wasteForm.get('metales')?.value === 'no'" (click)="wasteForm.get('metales')?.setValue('no')"></div></div></div>
          <div class="residue-item" style="background-color: #34495e;"><span>Papel y Cartón</span><div class="checkbox-group"><div class="custom-checkbox" [class.selected]="wasteForm.get('papelCarton')?.value === 'si'" (click)="wasteForm.get('papelCarton')?.setValue('si')"></div><div class="custom-checkbox" [class.selected]="wasteForm.get('papelCarton')?.value === 'no'" (click)="wasteForm.get('papelCarton')?.setValue('no')"></div></div></div>
          <div class="residue-item" style="background-color: #1c1c1c;"><span>No aprovechables</span><div class="checkbox-group"><div class="custom-checkbox" [class.selected]="wasteForm.get('noAprovechables')?.value === 'si'" (click)="wasteForm.get('noAprovechables')?.setValue('si')"></div><div class="custom-checkbox" [class.selected]="wasteForm.get('noAprovechables')?.value === 'no'" (click)="wasteForm.get('noAprovechables')?.setValue('no')"></div></div></div>
        </div>
      </ng-container>

      <!-- =================================================== -->
      <!-- ==      FORMULARIO PARA PERSONAL DE LIMPIEZA     == -->
      <!-- =================================================== -->
      <ng-container *ngIf="currentUserRole === 'PERSONAL'">
        
        <mat-form-field appearance="fill" class="custom-form-field">
          <mat-label>Pabellón</mat-label>
          <mat-select formControlName="edificioId" disableRipple>
            <mat-option *ngFor="let edificio of edificiosDeLaSede" [value]="edificio.id">
              {{ edificio.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Botones de Modo (Pestañas) -->
        <div class="mode-selector">
          <button type="button" class="mode-button" [class.active]="modoPersonalActivo === 'pilas'" (click)="setModoPersonal('pilas')">Pilas</button>
          <button type="button" class="mode-button" [class.active]="modoPersonalActivo === 'canastillas'" (click)="setModoPersonal('canastillas')">Canastillas</button>
          <button type="button" class="mode-button" [class.active]="modoPersonalActivo === 'tacho'" (click)="setModoPersonal('tacho')">Papel-ofi</button>
        </div>

        <h3 class="kg-title">Ingrese los datos en Kilogramos</h3>

        <!-- Sección PILAS -->
        <div class="kg-section" *ngIf="modoPersonalActivo === 'pilas'" formGroupName="pilas">
          <div class="kg-input-row"><span>Plásticos</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="plasticosKg" placeholder="Kg"></mat-form-field></div>
          <div class="kg-input-row"><span>Orgánicos</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="organicosKg" placeholder="Kg"></mat-form-field></div>
          <div class="kg-input-row"><span>Vidrio</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="vidrioKg" placeholder="Kg"></mat-form-field></div>
          <div class="kg-input-row"><span>Metales</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="metalesKg" placeholder="Kg"></mat-form-field></div>
          <div class="kg-input-row"><span>Papel y Cartón</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="papelCartonKg" placeholder="Kg"></mat-form-field></div>
          <div class="kg-input-row"><span>No aprovechables</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="noAprovechablesKg" placeholder="Kg"></mat-form-field></div>
        </div>

        <!-- Sección CANASTILLAS -->
        <div class="kg-section" *ngIf="modoPersonalActivo === 'canastillas'" formGroupName="canastillas">
          <div class="kg-input-row"><span>Plásticos</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="plasticosKg" placeholder="Kg"></mat-form-field></div>
        </div>

        <!-- Sección TACHO -->
        <div class="kg-section" *ngIf="modoPersonalActivo === 'tacho'" formGroupName="tacho">
          <div class="kg-input-row"><span>Papeles</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="papelKg" placeholder="Kg"></mat-form-field></div>
        </div>

      </ng-container>
      
      <!-- Botón de Envío (Común para ambos) -->
      <button mat-raised-button type="submit" class="submit-button" [disabled]="wasteForm.invalid">
        Enviar
      </button>
    </form>
  </ng-container>

  <ng-container *ngIf="!sedeActual">
    <p>Cargando datos del formulario...</p>
  </ng-container>
</div>