<div class="form-container">
  <!-- Loading -->
  <ng-container *ngIf="isLoading">
    <div class="loading-container">
      <p>⏳ Cargando datos del formulario...</p>
    </div>
  </ng-container>

  <!-- Formulario -->
  <ng-container *ngIf="!isLoading && sedeActual">
    <div class="form-header">
      <h2>Formulario Sede {{ sedeActual.nombre | uppercase }}</h2>
      <p>Ingrese los datos correctamente</p>
    </div>

    <form [formGroup]="staffForm" (ngSubmit)="onSubmit()" class="waste-actual-form">
        
      <!-- Selector de Pabellón/Edificio -->
      <mat-form-field appearance="fill" class="custom-form-field">
        <mat-label>Pabellón</mat-label>
        <mat-select formControlName="edificioId" disableRipple>
          <mat-option *ngIf="edificiosDeLaSede.length === 0" [value]="" disabled>
            No hay edificios disponibles para esta sede
          </mat-option>
          <mat-option *ngFor="let edificio of edificiosDeLaSede" [value]="edificio.id_edificio">
            {{ edificio.nombre }}
          </mat-option>
        </mat-select>
        <!-- ✅ SOLO MOSTRAR ERROR SI EL CAMPO FUE TOCADO Y EL FORMULARIO NO SE ESTÁ ENVIANDO -->
        <mat-error *ngIf="staffForm.get('edificioId')?.hasError('required') && 
                          staffForm.get('edificioId')?.touched && 
                          !isSubmitting">
     
        </mat-error>
      </mat-form-field>

      <!-- Botones de Modo (Pestañas) -->
      <div class="mode-selector">
        <button 
          *ngFor="let tipo of tiposRecoleccion"
          type="button" 
          class="mode-button" 
          [class.active]="modoPersonalActivo === getModoFromTipo(tipo)" 
          (click)="setModoPersonalFromTipo(tipo)">
          {{ tipo.nombre }}
        </button>
      </div>

      <h3 class="kg-title">Ingrese los datos en Kilogramos</h3>

      <!-- ✅ FORMULARIO DINÁMICO -->
      <div class="kg-section" [formGroupName]="getFormGroupName()">
        <div *ngFor="let campo of getCamposActuales()" class="kg-input-row">
          <span>{{ campo.label }}</span>
          <mat-form-field appearance="fill" class="kg-form-field">
            <input 
              matInput 
              [type]="campo.tipo"
              [formControlName]="campo.formControlName"
              [placeholder]="campo.placeholder || '0.00'"
              [min]="campo.min"
              [max]="campo.max"
              [step]="campo.step">
          </mat-form-field>
        </div>
      </div>
      
      <!-- Botón de Envío -->
      <button 
        mat-raised-button 
        type="submit" 
        class="submit-button" 
        [disabled]="staffForm.invalid || isSubmitting || edificiosDeLaSede.length === 0">
        <span *ngIf="!isSubmitting">Enviar</span>
        <span *ngIf="isSubmitting">Enviando...</span>
      </button>
    </form>
  </ng-container>

  <!-- Error -->
  <ng-container *ngIf="!isLoading && !sedeActual">
    <div class="error-container">
      <p>❌ No se pudo cargar la información de la sede.</p>
      <button mat-raised-button (click)="volverASedes()">
        Volver a Sedes
      </button>
    </div>
  </ng-container>
</div>