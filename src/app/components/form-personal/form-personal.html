<div class="form-container">
  <ng-container *ngIf="sedeActual">

    <div class="form-header">
      <h2>Formulario Sede {{ sedeActual.name | uppercase }}</h2>
      <p>Ingrese los datos correctamente</p>
    </div>

    <!-- El formulario ahora usa el FormGroup 'staffForm' -->
    <form [formGroup]="staffForm" (ngSubmit)="onSubmit()" class="waste-actual-form">
        
      <mat-form-field appearance="fill" class="custom-form-field">
        <mat-label>Pabellón</mat-label>
        <mat-select formControlName="edificioId" disableRipple>
          <mat-option *ngFor="let edificio of edificiosDeLaSede" [value]="edificio.id">
            {{ edificio.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Botones de Modo (Pestañas) -->
      <div class="mode-selector">
        <button type="button" class="mode-button" [class.active]="modoPersonalActivo === 'pilas'" (click)="setModoPersonal('pilas')">Pilas</button>
        <button type="button" class="mode-button" [class.active]="modoPersonalActivo === 'canastillas'" (click)="setModoPersonal('canastillas')">Canastillas</button>
        <button type="button" class="mode-button" [class.active]="modoPersonalActivo === 'tacho'" (click)="setModoPersonal('tacho')">Papel-ofi</button>
      </div>

      <h3 class="kg-title">Ingrese los datos en Kilogramos</h3>

      <!-- Sección PILAS -->
      <div class="kg-section" *ngIf="modoPersonalActivo === 'pilas'" formGroupName="pilas">
        <div class="kg-input-row"><span>Plásticos</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="plasticosKg" placeholder="Kg"></mat-form-field></div>
        <div class="kg-input-row"><span>Orgánicos</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="organicosKg" placeholder="Kg"></mat-form-field></div>
        <div class="kg-input-row"><span>Vidrio</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="vidrioKg" placeholder="Kg"></mat-form-field></div>
        <div class="kg-input-row"><span>Metales</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="metalesKg" placeholder="Kg"></mat-form-field></div>
        <div class="kg-input-row"><span>Papel y Cartón</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="papelCartonKg" placeholder="Kg"></mat-form-field></div>
        <div class="kg-input-row"><span>No aprovechables</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="noApropiablesKg" placeholder="Kg"></mat-form-field></div>
      </div>

      <!-- Sección CANASTILLAS -->
      <div class="kg-section" *ngIf="modoPersonalActivo === 'canastillas'" formGroupName="canastillas">
        <div class="kg-input-row"><span>Plásticos</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="plasticosKg" placeholder="Kg"></mat-form-field></div>
      </div>

      <!-- Sección TACHO -->
      <div class="kg-section" *ngIf="modoPersonalActivo === 'tacho'" formGroupName="tacho">
        <div class="kg-input-row"><span>Papeles</span><mat-form-field appearance="fill" class="kg-form-field"><input matInput type="number" formControlName="papelKg" placeholder="Kg"></mat-form-field></div>
      </div>
      
      <!-- Botón de Envío (Común para ambos) -->
      <button mat-raised-button type="submit" class="submit-button" [disabled]="staffForm.invalid">
        Enviar
      </button>
    </form>
  </ng-container>

  <ng-container *ngIf="!sedeActual">
    <p>Cargando datos del formulario...</p>
  </ng-container>
</div>